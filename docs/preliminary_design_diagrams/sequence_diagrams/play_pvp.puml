@startuml

title Play PvP

actor BlackPlayer
actor WhitePlayer
participant Game
participant Board
participant Move
participant GameRecord

loop game has not ended
    alt black turn
        break black player decides to concede
            BlackPlayer -> Game : concede()
            activate Game
            Game -> GameRecord : saveGame(self)
            activate GameRecord
            deactivate GameRecord
            deactivate Game
        end

        alt black player decides to draw
        ref over BlackPlayer, WhitePlayer, Game : Offer Draw
        end

        Game -> BlackPlayer : getMove(board)
        activate BlackPlayer
        BlackPlayer --> Game : move
        deactivate BlackPlayer
    else white turn

        break white player decides to concede
            WhitePlayer -> Game : concede()
            activate Game
            Game -> GameRecord : saveGame(self)
            activate GameRecord
            deactivate GameRecord
            deactivate Game
        end

        alt white player decides to draw
        ref over BlackPlayer, WhitePlayer, Game : Offer Draw
        end


        Game -> WhitePlayer : getMove(board)
        activate WhitePlayer
        WhitePlayer --> Game : move
        deactivate WhitePlayer
    end
    autoactivate off
    Game -> Board: updateBoard(move)
        activate Board
            Board -> Board: validateMove(move)
                activate Board
                deactivate Board
            Board -> Board: isRepetition(move)
                activate Board
                deactivate Board
            Board -> Board: isCheckmate(move)
                activate Board
                deactivate Board
            Board -> Board: isStalemate(move)
                activate Board
                deactivate Board
            alt move is invalid
                Board --> Game : false
            else move is valid
                Board -> Move : storeMove()
                Board --> Game : true
                deactivate Board
            end
end

Game -> GameRecord : saveGame(self)
activate GameRecord
deactivate GameRecord
@enduml
